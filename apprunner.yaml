version: 1.0
runtime: nodejs22
build:
  commands:
    # Install frontend (root) deps and build Vite
    pre-build:
      - npm install --omit=dev=false
    build:
      - npm run build
    # Install backend deps
    post-build:
      - cd backend && npm install --omit=dev=true
run:
  # Lock to a Node version (optional but recommended). Pick a supported version.
  runtime-version: 22.14.0
  # Start the single Node app that serves both API and static frontend
  command: npm start
  network:
    port: 8080
    env: APP_PORT
  env:
    - name: NODE_ENV
      value: production
    # If your backend depends on environment vars, add them here:
    # - name: DYNAMO_TABLE
    #   value: Jewelry_Boutique
    # - name: AWS_REGION
    #   value: us-east-1