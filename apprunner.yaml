version: 1.0
runtime: nodejs22
build:
  commands:
    pre-build:
      - |
        if [ -f pnpm-lock.yaml ]; then
          npm i -g pnpm@8 && pnpm install --frozen-lockfile;
        elif [ -f yarn.lock ]; then
          npm i -g yarn && yarn install --frozen-lockfile;
        elif [ -f package-lock.json ]; then
          npm ci;
        else
          npm install;
        fi
    build:
      - npx vite build --base=./
    post-build:
      - |
        cd backend
        if [ -f pnpm-lock.yaml ]; then
          npm i -g pnpm@8 && pnpm install --prod --frozen-lockfile;
        elif [ -f yarn.lock ]; then
          npm i -g yarn && yarn install --production --frozen-lockfile;
        elif [ -f package-lock.json ]; then
          npm ci --omit=dev;
        else
          npm install --omit=dev;
        fi
run:
  runtime-version: 22.14.0
  command: npm start
  network:
    port: 8080
    env: APP_PORT
  env:
    - name: NODE_ENV
      value: production
    # Add any required backend env vars here (DYNAMO_TABLE, AWS_REGION, etc.)